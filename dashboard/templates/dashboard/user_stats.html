<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Î§ÏÎ¿Î½Î¿ÏƒÎµÎ¹ÏÎ¬ Î•Î³Î³ÏÎ±Ï†ÏÎ½ Î§ÏÎ·ÏƒÏ„ÏÎ½</title>
    <script src="https://unpkg.com/htmx.org@1.9.2"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        body { font-family: Arial; }
        .bar { height: 20px; background: #3498db; margin-bottom: 4px; }
        .form { margin: 1em 0; }
    </style>
</head>
<body x-data="{ loading: false }">

    <h1>ğŸ“Š Î§ÏÎ¿Î½Î¿ÏƒÎµÎ¹ÏÎ¬ Î•Î³Î³ÏÎ±Ï†ÏÎ½ Î§ÏÎ·ÏƒÏ„ÏÎ½</h1>

    <div class="form">
        <form hx-get="/stats/" hx-target="#results" @htmx:before-request="loading = true" @htmx:after-request="loading = false">
            Î‘Ï€ÏŒ: <input type="date" name="start">
            ÎˆÏ‰Ï‚: <input type="date" name="end">
            <button type="submit">Î¦Î¯Î»Ï„ÏÎ¿</button>
        </form>
    </div>

    <div x-show="loading">Î¦ÏŒÏÏ„Ï‰ÏƒÎ·...</div>

    <div id="results" hx-get="/stats/" hx-trigger="load">
        <!-- Î¤Î± Î±Ï€Î¿Ï„ÎµÎ»Î­ÏƒÎ¼Î±Ï„Î± Î¸Î± Ï†Î¿ÏÏ„Ï‰Î¸Î¿ÏÎ½ ÎµÎ´Ï -->
    </div>

    <script>
        document.addEventListener("htmx:afterOnLoad", function(evt) {
            const data = JSON.parse(evt.detail.xhr.responseText);
            const container = document.getElementById("results");

            if (data.length === 0) {
                container.innerHTML = "<p>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎµÎ³Î³ÏÎ±Ï†Î­Ï‚ Î³Î¹Î± Ï„Î¿ ÎµÏ€Î¹Î»ÎµÎ³Î¼Î­Î½Î¿ Î´Î¹Î¬ÏƒÏ„Î·Î¼Î±.</p>";
                return;
            }

            container.innerHTML = `
                <h2>ğŸ“… Î Î¯Î½Î±ÎºÎ±Ï‚ Î•Î³Î³ÏÎ±Ï†ÏÎ½</h2>
                <table border="1" cellpadding="5">
                    <tr><th>Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±</th><th>Î•Î³Î³ÏÎ±Ï†Î­Ï‚</th></tr>
                    ${data.map(d => `<tr><td>${d.day}</td><td>${d.count}</td></tr>`).join('')}
                </table>

                <h2>ğŸ“ˆ Î“ÏÎ±Ï†Î¹ÎºÎ® Î Î±ÏÎ¬ÏƒÏ„Î±ÏƒÎ·</h2>
                ${data.map(d => `
                    <div>
                        <strong>${d.day}</strong>
                        <div class="bar" style="width: ${d.count * 10}px"></div>
                    </div>
                `).join('')}
            `;
        });
    </script>

</body>
</html>
